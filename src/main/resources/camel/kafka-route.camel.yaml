- route:
    id: customer-change-event-route
    from:
      uri: kafka:{{app.input-topic-name}}
      parameters:
        topicIsPattern: true
      steps:
        - filter:
            steps:
              - log:
                  message: "- Recieve Topic Message : ${body}"
              - unmarshal:
                  id: unmarshal-Json-to-Object
                  json:
                    unmarshalType: com.redhat.example.entity.KijitsuNyukinRequestEntity
              - process:
                  id: process-DepositEntryCheck
                  description: 入金受付チェック
                  ref: "#class:com.redhat.example.processor.DepositEntryCheckProcessor"
              - process:
                  id: process-DepositCategory
                  description: 入金種類区分取得
                  ref: "#class:com.redhat.example.processor.DepositCategoryProcessor"
              - process:
                  id: process-CheckAvailableDepositAmount
                  description: 入金可能額照会
                  ref: "#class:com.redhat.example.processor.CheckAvailableDepositAmountProcessor"
              - process:
                  id: process-DepositAllocation
                  description: 入金充当額試算
                  ref: "#class:com.redhat.example.processor.DepositAllocationProcessor"
              - log:
                  message: "- Exchange Message  : ${body}"
              - process:
                  id: process-Set-Deposit-Result-Message
                  description: set deposit result message
                  ref: "#class:com.redhat.example.processor.SetDepositResultMessageProcessor"
              - marshal:
                  description: marshal-Object-to-Json
                  json: {}
              - to:
                  id: to-Kafka
                  uri: kafka:{{app.output-topic-name}}
                  parameters: {}
            simple: ${body} != null
